<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM28 Produktionsplan</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body data-machine="SM28">
    <div class="sm25-app">
        <aside class="sm25-sidebar">
            <div class="sm25-logo">üüß SM28</div>
            <nav>
                <a href="index.html" class="sidebar-link">‚Üê Tillbaka till √∂versikt</a>
            </nav>
            <div class="machine-sidebar">
                <h2>V√§lj maskin</h2>
                <div class="machine-list">
                    <a href="SM25.html" class="machine-btn">üü¶ SM25</a>
                    <a href="SM27.html" class="machine-btn">üü© SM27</a>
                    <a href="SM28.html" class="machine-btn">üüß SM28</a>
                </div>
            </div>
        </aside>
        <main class="sm25-main">
            <header class="sm25-header">
                <h1>SM28 Produktionsplan</h1>
                <p class="sm25-sub">Planering och utr√§kning f√∂r dagens produktion. V√§lj skift nedan f√∂r att se detaljerad planering och summering.</p>
                <label>Plan:
                    <select id="planSelect"></select>
                </label>
                <button id="manualStopBtn" class="small-btn">L√§gg till stopp</button>
                <span id="stopInfo"></span>
            </header>
            <section id="shiftSummary" class="shift-summary-section"></section>
            <div id="shiftBarContainer"></div>
            <section id="shiftsOverview" class="shifts-overview"></section>
            <section id="shiftAnalysis" class="shift-analysis-section"></section>
        </main>
    </div>
    <script src="production.js"></script>
    <script src="machine.js"></script>
    <script>
    // --- Dynamisk rendering av skift, summering och analys ---
    function renderShiftsOverview(shifts) {
        const container = document.getElementById('shiftsOverview');
        container.innerHTML = '';
        const shiftColors = { FM: '#6366f1', EM: '#06b6d4', Natt: '#fbbf24' };
        const shiftNames = { FM: 'FM (06:00-14:00)', EM: 'EM (14:00-22:30)', Natt: 'Natt (22:30-06:00)' };
        Object.keys(shifts).forEach(shiftKey => {
            const shift = shifts[shiftKey];
            const orders = shift.orders || [];
            const maxKgPerHour = Math.max(...Object.values(shifts).map(s=>s.kgPerHour));
            const percent = maxKgPerHour ? Math.round((shift.kgPerHour/maxKgPerHour)*100) : 0;
            const color = shiftColors[shiftKey];
            const icon = shiftKey==='FM'?'üåÖ':shiftKey==='EM'?'üåá':'üåô';
            const shiftDiv = document.createElement('div');
            shiftDiv.className = 'shift-block';
            shiftDiv.innerHTML = `
                <div class="shift-block-header" style="color:${color}">${icon} <b>${shiftNames[shiftKey]}</b></div>
                <div class="shift-progress-bar" style="background:#e0e7ef">
                    <div class="shift-progress" style="width:${percent}%;background:${color}"></div>
                </div>
                <div class="shift-block-summary">
                    <span>Ordrar: <b>${shift.totalOrders}</b></span>
                    <span>KG: <b>${shift.totalKg.toFixed(1)}</b></span>
                    <span>KG/TIM: <b>${shift.kgPerHour.toFixed(2)}</b></span>
                </div>
                <div class="shift-orders-list">
                    ${orders.map(order => `
                        <div class="shift-order-card">
                            <span class="order-id">#${order['Kundorder']||order['OrderID']||''}</span>
                            <span class="order-weight">${order['Planerad Vikt']||0} kg</span>
                            <span class="order-time">${(order.adjustedTime/60).toFixed(2)} h</span>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(shiftDiv);
        });
    }
    // Summering och analys renderas p√• liknande s√§tt i shiftSummary och shiftAnalysis
    // Se till att machine.js anropar dessa render-funktioner med r√§tt data!
    </script>
</body>
</html>
